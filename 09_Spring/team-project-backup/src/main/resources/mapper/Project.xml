<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.sh.haagendazo.bio.mapper.ProjectMapper">
<resultMap type="ProjectDTO" id="ProjectParam">
	<id property="projectId" column="project_id" />
		<result property="projectCode" column="project_code"/>
		<result property="projectName" column="project_name"/>
		<result property="projectType" column="project_type"/>
		<result property="managerId" column="manager_id"/>
		<result property="status" column="status"/>
		<result property="endDate" column="end_date"/>
		<result property="createdAt" column="created_at"/>
		<result property="updatedAt" column="updated_at"/>
		<result property="userName" column="name"/>
</resultMap>

<select id="allProject" resultMap="ProjectParam">
    SELECT * FROM project 
    LEFT JOIN project_member USING (project_id)
    LEFT JOIN user USING (user_id) 
    <where>
        <choose>
	 	<when test="select == 'projectCode'">
		 	<if test ="search != null">AND project_code LIKE CONCAT ('%', #{search},'%')</if>
		 	<if test ="search == null"></if>
	 	</when>
	 	<when test="select == 'projectName'">
		 	<if test ="search != null">AND project_name LIKE CONCAT ('%', #{search},'%')</if>
		 	<if test ="search == null"></if>
	 	</when>
	 	<when test="select == 'manager'">
		    <if test="search != null">AND name LIKE CONCAT('%', #{search}, '%')</if>
		    <if test ="search == null"></if>
		</when>
	 	<when test="select == 'status'">
		 	<if test ="search != null">AND status LIKE CONCAT ('%', #{search},'%')</if>
		 	<if test ="search == null"></if>
	 	</when>
	 	<when test="select == 'projectType'">
		 	<if test ="search != null">AND project_type LIKE CONCAT ('%', #{search},'%')</if>
		 	<if test ="search == null"></if>
	 	</when>
	 	<when test="select == 'unknown'">
		 	AND user_id=0
	 	</when>
	 	</choose>
    </where>
</select>

<select id="projectDetail" resultMap="ProjectParam">
 SELECT * FROM project 
    LEFT JOIN project_member USING (project_id)
    LEFT JOIN user USING (user_id) 
    WHERE project_id = #{projectId}
</select>

 <insert id="insertProject" parameterType="ProjectDTO">
 	INSERT INTO project(project_code, project_name, project_type, status, start_date) VALUES (#{projectCode},#{projectName},#{projectType},#{status},#{startDate})
 </insert>

 <update id="updateProject" parameterType="ProjectDTO">
 	UPDATE project SET manager_id = #{managerId}, status = #{status}, end_date = #{endDate} WHERE project_id=#{projectId} 
 </update>

 <delete id="deleteProject" parameterType="Integer">
 	DELETE FROM project WHERE project_id= #{projectId}
 </delete>
</mapper>